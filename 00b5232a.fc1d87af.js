(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{56:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return s})),t.d(n,"rightToc",(function(){return l})),t.d(n,"default",(function(){return p}));var r=t(2),a=t(6),o=(t(0),t(98)),c={id:"Node01",title:"Node \u57fa\u7840api\u4e0eCLI, \u5b9e\u73b0CLI\u5de5\u5177"},s={unversionedId:"Node/Node01",id:"Node/Node01",isDocsHomePage:!1,title:"Node \u57fa\u7840api\u4e0eCLI, \u5b9e\u73b0CLI\u5de5\u5177",description:"fs",source:"@site/docs/Node/node01.md",slug:"/Node/Node01",permalink:"/docs/Node/Node01",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/Node/node01.md",version:"current",sidebar:"someSidebar",previous:{title:"\u5b9e\u73b0RCForm",permalink:"/docs/React/RC-field-form"},next:{title:"\u88c5\u9970\u5668",permalink:"/docs/Node/DECORATOR"}},l=[{value:"fs",id:"fs",children:[]},{value:"Buffer \u7f13\u51b2\u533a",id:"buffer-\u7f13\u51b2\u533a",children:[]},{value:"Http",id:"http",children:[]},{value:"\u5b9e\u73b0 CLI \u5de5\u5177",id:"\u5b9e\u73b0-cli-\u5de5\u5177",children:[]},{value:"\u514b\u9686\u811a\u624b\u67b6",id:"\u514b\u9686\u811a\u624b\u67b6",children:[{value:"\u542f\u52a8\u9879\u76ee",id:"\u542f\u52a8\u9879\u76ee",children:[]},{value:"\u7ea6\u5b9a\u8def\u7531\u529f\u80fd",id:"\u7ea6\u5b9a\u8def\u7531\u529f\u80fd",children:[]}]}],i={rightToc:l};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},i,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"fs"},"fs"),Object(o.b)("p",null,"fs \u662f\u5728 node \u73af\u5883\u4e2d\u8bfb\u53d6\u672c\u5730\u6587\u4ef6\u7684 API\uff0c\u5206\u4e3a\u540c\u6b65\u8bfb\u53d6\u548c\u5f02\u6b65\u8bfb\u53d6\uff0c\u540c\u6b65\u8bfb\u53d6\u57fa\u672c\u4e0d\u600e\u4e48\u5e38\u7528\uff0c\u901a\u5e38\u6765\u8bf4\u7528\u5f02\u6b65\u8bfb\u53d6\uff0c"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),'const fs = require("fs");\n\n// \u540c\u6b65\u8bfb\u53d6\nconst data = fs.readFileSync("./conf.js");\nconsole.log("data:", data); // \u4e8c\u8fdb\u5236 Buffer\nconsole.log("data:", data.toString());\n\n// \u5f02\u6b65\u8bfb\u53d6\nfs.readFile("./conf.js", (err, data) => {\n  if (err) throw err;\n  console.log("data:", data.toString());\n}); // \u5728node \u4e2d\u6709\u4e00\u4e2a\u7ea6\u5b9a\uff0c\u9519\u8bef\u4f18\u5148\uff0c\u7b2c\u4e00\u4e2a\u8fd4\u56de\u503c\u662ferror\u5bf9\u8c61\n')),Object(o.b)("p",null,"\u5982\u679c\u90fd\u7528\u56de\u8c03\u7684\u65b9\u5f0f\uff0c\u4f1a\u4ea7\u751f\u56de\u8c03\u5730\u72f1\uff0c\u5728 node"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),'(async () => {\n  const fs = require("fs");\n  const { promisify } = require("util");\n  const readFile = promisify(fs.readFile);\n  const data = await readFile("./conf.js");\n  console.log("data", data.toString());\n})();\n')),Object(o.b)("p",null,"promisify API \u7b80\u5199"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"module.exports = function promisify(fn) {\n  return function (...args) {\n    return new Promise(function (resolve, reject) {\n      args.push(function (err, ...arg) {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(...args);\n        }\n      });\n      fn.apply(null, args);\n    });\n  };\n};\n")),Object(o.b)("h2",{id:"buffer-\u7f13\u51b2\u533a"},"Buffer \u7f13\u51b2\u533a"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"\u8bfb\u53d6\u6570\u636e\u7c7b\u578b\u4e3a Buffer\n\u5e38\u7528\u5728 TCP \u6d41\u3001\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\u3001\u7f51\u7edc\u901a\u4fe1\uff0c\u672c\u5730\u6587\u4ef6\uff0cBuffer \u4e3b\u8981\u5904\u7406\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),'const buf1 = Buffer.alloc(10); // \u5206\u914d\u7f13\u51b2\u533a 10 -> 10\u4e2a\u5b57\u8282\n\nconst buf2 = Buffer.from("a"); // \u5f00\u8f9f\u4e00\u4e2a\u7f13\u51b2\u533a \u5b58\u50a8\u4e00\u4e2a\u5b57\u7b26\u4e32\nconsole.log(buf2); // <Buffer> <61>  \u5b58\u50a8 a\u7684ASCII \u7801\nconst buf3 = Buffer.from("\u4e2d\u6587");\nconst buf3 = Buffer.concat([buf2, buf3]);\n')),Object(o.b)("h2",{id:"http"},"Http"),Object(o.b)("p",null,"\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u6700\u57fa\u672c\u7684 http \u670d\u52a1\uff0c\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u8f93\u5165 localhost:3000 \u5c31\u53ef\u4ee5\u770b\u5230\u6587\u5b57: hello world."),Object(o.b)("p",null,"\ud83e\udd14\uff1a \u8fd9\u91cc\u4e3a\u4ec0\u4e48\u662f response.end \u7684\u65b9\u6cd5\uff0c\u5982\u679c\u662f",Object(o.b)("code",null,"response.body =\xa0'abc'")," \u4e0d\u662f\u66f4\u52a0\u660e\u663e\u5417"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const http = require('http');\nconst server = http.createServe((request, response) => {\n    console.log('this is a req');\n    response.end('hello world');\n    console.log(getPrototypeChain(response))\n})\nserver.listen(3000)\n")),Object(o.b)("p",null,"\u6211\u4eec\u5199\u4e00\u4e2a\u51fd\u6570\u6253\u5370\u4e00\u4e0b response \u7684\u539f\u578b\u94fe"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"function getPrototypeChain(obj) {\n  const protoChain = [];\n  while ((obj = Object.getPrototypeOf(obj))) {\n    protoChain.push(obj);\n  }\n  return potoChain;\n}\n")),Object(o.b)("p",null,"\u7ee7\u627f\u4e86 Stream(\u6d41) \u4e2d\u7684 end \u51fd\u6570\nStream \u662f\u7528\u4e8e\u4e0enode\u4e2d\u6d41\u6570\u636e\u4ea4\u4e92\u7684\u63a5\u53e3"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const fs = require('fs');\nconst rs2 = fs.createReadStream('./01.jpg');\nconst ws2 = fs.createWriteStream('./02.jpg');\n\nrs2.pipe(ws2);\n// \u8fd9\u91ccpipe\u51fd\u6570\u662f\u7ba1\u9053\uff0c\u8bfb\u51fa\u56fe\u7247\u6d41\uff0c\u5199\u5165\u6587\u4ef6\u6d41\n")),Object(o.b)("p",null,"\u6211\u4eec\u5199\u4e00\u70b9\u590d\u6742\u7684\u4ee3\u7801\uff0c\u521b\u5efa\u4e00\u4e2a\u6700\u57fa\u7840\u7684\u9875\u9762\u670d\u52a1"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const http = require('http');\nconst server = http.createServe((request, response) => {\n const {url} = requset;\n if(url === '/' && method === 'GET') {\n   fs.readFile('index/hhtml', (err, data) => {\n     if(err) {\n       response.writeHead(500, {'Content-Type': 'text/plain:charset=utf-8'}); // \u89e3\u6790\u4e2d\u6587\n      response.end('500 \u7cfb\u7edf\u5f00\u5c0f\u83dc')\n       return;\n     }\n     response.statusCode = 200;\n     response.setHeader('Content-Type', 'text/html')\n     response.end(data)\n   });\n } else if(url ==='/users' && method ==='GET') {\n      response.writeHead(200, {'Content-Type': 'application/json'});\n      response.end(JSON.stringify({name: 'TOM'}))\n } else {\n       response.statusCode = 404;\n       response.setHeader('Content-Type', 'text/html');\n       response.end('404 nopage')\n }\n})\nserver.listen(3000)\n")),Object(o.b)("hr",null),Object(o.b)("h2",{id:"\u5b9e\u73b0-cli-\u5de5\u5177"},"\u5b9e\u73b0 CLI \u5de5\u5177"),Object(o.b)("p",null,"\u9996\u5148\uff1a \u6211\u4eec\u5148\u521b\u5efa\u521d\u59cb\u5316\u9879\u76ee\uff0c\u5e76\u4e14\u521b\u5efa bin \u6587\u4ef6\u5939\uff0c\u5728\u91cc\u9762\u521b\u5efa\u4e00\u4e2a js \u811a\u672c"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"npm init -y\nmkdir ./bin\ntouch ./bin/index.js\n")),Object(o.b)("p",null,"\u8ba9\u6211\u4eec\u4f60\u4f7f\u7528 CRA(create react app)\u6216\u8005 Vue \u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u6709\u4e00\u4e2a\u7ec8\u7aef\u754c\u9762\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4e5f\u6253\u9020\u4e00\u4e2a\u5dee\u4e0d\u591a\u7684\u7ec8\u7aef\u754c\u9762\u50cf\u8fd9\u6837"),Object(o.b)("p",null,"\u6211\u4eec\u9700\u8981\u5b89\u88c5\u4e00\u4e9b\u5305,\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4,\u5e76\u4e14\u4fee\u6539package.json\u4e2d\u7684bin\u6307\u5b9a\u811a\u672c"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),'npm init -y\nnpm i commander download-git-repo ora handlebars figlet clear chalk open -s\n\n// package.json\n"bin": {\n  "Cli": \'./bin/index.js\'\n}\n')),Object(o.b)("p",null,"\u7136\u540e\u6211\u4eec\u8981\u5728\u7ec8\u7aef\u4e2d\u4f7f\u7528\uff0c\u9700\u8981\u628aLink\u672c\u5730\u7684npm"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"npm link \n")),Object(o.b)("p",null,"\u5982\u679c\u8981\u5728\u7ec8\u7aef\u8f93\u5165\u663e\u793a\u8fd9\u6837\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u9700\u8981\u5728 package.json \u4e2d\u6ce8\u518c\u4ee5\u4e0b\uff0c"),Object(o.b)("p",null,"\u7136\u540e\u6211\u4eec\u6267\u884c",Object(o.b)("code",null,"sudo npm link"),"\uff0c\u6210\u529f\u6211\u4eec\u5728\u7ec8\u7aef\u8f93\u5165\u547d\u4ee4\u5c31\u4f1a\u51fa\u73b0\u4e0a\u9762\u56fe\u4e2d\u7684\u7ed3\u679c"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),'#!/usr/bin/env node\nconst program = require("commander");\n\nprogram.version(require("./package.json").version); //\u8bfb\u53d6package\u4e2d\u7684\u7248\u672c\u53f7\n\n// \u5f53\u6211\u4eec\u5728\u7ec8\u7aef\u9a76\u5165\n\nprogram\n  .command("init <name>")\n  .description("init project")\n  .action((item) => {\n    console.log("init" + item);\n  });\n// \u56fa\u5b9a\u5199\u6cd5 process \u4ee3\u8868\u4e3b\u8fdb\u7a0b argv \u4ee3\u8868\u7a0b\u5e8f\u4e2d\u6240\u6709\u53c2\u6570\nProgress.parse(process.argv);\n')),Object(o.b)("p",null,"\u5728\u7ec8\u7aef\u76f4\u63a5\u8f93cli \u4f1a\u770b\u5230\u76f8\u5e94\u754c\u9762\n\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u6253\u9020\u4e00\u4e2a\u6b22\u8fce\u754c\u9762"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),'// /lib/init.js\nconst { promisify } = require("util");\nconst chalk = require("chalk");\nconst clear = require("clear");\nconst figlet = require(\'figlet\');\n\nconst log = content => console.log(chalk.green(content))\nmodule.exports = async (name) => {\n  // \u6253\u5370\u6b22\u754c\u9762\n  clear();\n  const data = await figlet(\'Welcome\');\n  log(data);\n};\n')),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// /bin/index.js\nprogram\n  .command('init <name>')\n  .description('init project')\n  .action(require('../lib/init'))\n\nfunction classof(value){\n  if(typeof value === 'object'){\n    return Object.prototype.toString().call(value)\n  } else {\n    return typeof value\n  }\n}\n")),Object(o.b)("h2",{id:"\u514b\u9686\u811a\u624b\u67b6"},"\u514b\u9686\u811a\u624b\u67b6"),Object(o.b)("p",null,"/lib/download.js"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const { promisify } = require('util')\nmodule.exports.clone = async function(repo, desc) {\n  const download = promisify(require('download-git-repo'));\n  const ora = require('ora');\n  const process = ora('\u4e0b\u8f7d.....${repo}')\n  process.start();\n  await download(repo, desc);\n  process.succeed();\n}\n")),Object(o.b)("p",null,"/lib/init.js"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const { clone } = require('./download');\nmodule.exports.init = async name => {\n  log('\ud83d\ude80\u521b\u5efa\u9879\u76ee:' + name)\n  await clone('url', name)\n}\n")),Object(o.b)("p",null,"\u4e0b\u8f7d\u6210\u529f\u4e4b\u540e\u6211\u4eec\u9700\u8981\u5b89\u88c5\u4f9d\u8d56"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// \u5bf9\u63a5\u8f93\u51fa\u6d41\nconst spawn = async (...args) => {\n  const { spawn } = require('child_process');\n  return new Promise(resolve => {\n    const proc = spawn(...args);\n    proc.stdout.pipe(process.stdout);\n    proc.stderr.pipe(process.stderr);\n    proc.on('close', () => {\n      resolve()\n    })\n  })\n}\n\nmodule.exports.init = async name => {\n  log('\u5b89\u88c5\u4f9d\u8d56')\n  await spawn('cnpm', ['install', { cwd: `./${name}`}])\n  log(chalk.green(`\n  \ud83d\udc4c\u5b89\u88c5\u5b8c\u6210\uff1aTo get Start:\n  ===========================    \n  cd ${name}    \n  npm run serve\n  ===========================\n  `))\n}\n")),Object(o.b)("h3",{id:"\u542f\u52a8\u9879\u76ee"},"\u542f\u52a8\u9879\u76ee"),Object(o.b)("p",null,"\u542f\u52a8\u9879\u76ee\u4e4b\u540e\u6211\u4eec\u9700\u8981\u6253\u5f00\u6d4f\u89c8\u5668, \u5b89\u88c5node open \u5305"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const open = require('open')\nmodule.exports.init = async name => {\n  open('http://localhost:8080');\n  await spawn('npm', ['run', 'serve'], {cwd: `./${name}`})\n}\n")),Object(o.b)("h3",{id:"\u7ea6\u5b9a\u8def\u7531\u529f\u80fd"},"\u7ea6\u5b9a\u8def\u7531\u529f\u80fd"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"loader\u6587\u4ef6\u626b\u63cf")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"\u4ee3\u7801\u6a21\u677f\u6e32\u67d3\n/lib/refresh.js"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const fs = require('fs');\nconst handlebars = require('handlebars');\nmodule.exports = async () => {\n// \u83b7\u53d6\u9875\u9762\u5217\u8868\nconst list = \n  fs.readdirSync('./src/views')\n    .filter(v => v !== 'Home.vue')\n    .map(v => ({\n      name: v.replace('.vue','').toLowerCase(),\n      file: v\n    }));\n// \u751f\u6210\u8def\u7531\u5b9a\u4e49\ncompile({list}, './src/router.hs','./template/router.js')\n\n// \u751f\u6210\u83dc\u5355\n\ncompile({list}, './src/App.vue', './template/App.vue')\n}\n")),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"function compile(meta, filePath, templatePath) {\n  if(fs.existsSync(templatePath)) {\n\n    const content = fs.readFileSync(templatePath).toString();\n    const result = handlebars.compile(content)(meta);\n    fs.writeFileSync(filePath, result);\n\n  }\n  console.log(chalk.green('\ud83d\ude80${filePath} \u521b\u5efa\u6210\u529f'))\n}\n\n")),Object(o.b)("p",{parentName:"li"},"\u6700\u540e\u4fee\u6539/bin/index.js\u91cc\u9762\u7684\u6587\u4ef6"))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"program\n  .command('refresh')\n  .description('refresh routers...')\n  .action(require('../lib/refresh'));\n")))}p.isMDXComponent=!0},98:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return m}));var r=t(0),a=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=a.a.createContext({}),p=function(e){var n=a.a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},b=function(e){var n=p(e.components);return a.a.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},d=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),b=p(t),d=r,m=b["".concat(c,".").concat(d)]||b[d]||u[d]||o;return t?a.a.createElement(m,s(s({ref:n},i),{},{components:t})):a.a.createElement(m,s({ref:n},i))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,c=new Array(o);c[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,c[1]=s;for(var i=2;i<o;i++)c[i]=t[i];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);